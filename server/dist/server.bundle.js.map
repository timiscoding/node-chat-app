{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"passport\"","webpack:///external \"mongoose\"","webpack:///external \"express\"","webpack:///external \"path\"","webpack:///external \"hbs\"","webpack:///./server/server.js","webpack:///external \"express-validator/check\"","webpack:///external \"body-parser\"","webpack:///external \"moment\"","webpack:///external \"bcrypt\"","webpack:///./server/models/user.model.js","webpack:///./server/db.js","webpack:///./server/utils/validation.js","webpack:///./server/utils/message.js","webpack:///./server/socketEvent.js","webpack:///./server/utils/users.js","webpack:///./server/utils/helpers.js","webpack:///./server/controllers/user.controller.js","webpack:///./server/routes/user.router.js","webpack:///./server/controllers/auth.controller.js","webpack:///./server/routes/auth.router.js","webpack:///./server/routes/index.js","webpack:///external \"connect-ensure-login\"","webpack:///external \"connect-flash\"","webpack:///external \"express-session\"","webpack:///./server/middleware.js","webpack:///external \"lodash\"","webpack:///external \"passport-google-oauth\"","webpack:///external \"passport-twitter\"","webpack:///external \"passport-facebook\"","webpack:///external \"passport-local\"","webpack:///external \"mongoose-beautiful-unique-validation\"","webpack:///external \"validator/lib/isEmail\"","webpack:///external \"hbs-utils\"","webpack:///external \"socket.io\"","webpack:///external \"http\"","webpack:///./server/passport.js","webpack:///./server/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","_routes__WEBPACK_IMPORTED_MODULE_10__","app","express__WEBPACK_IMPORTED_MODULE_0___default","server","http__WEBPACK_IMPORTED_MODULE_1___default","a","createServer","io","socket_io__WEBPACK_IMPORTED_MODULE_2___default","_db__WEBPACK_IMPORTED_MODULE_6__","catch","err","console","error","message","hbs__WEBPACK_IMPORTED_MODULE_3___default","localsAsTemplateData","registerHelper","obj","JSON","stringify","hbsUtils","hbs_utils__WEBPACK_IMPORTED_MODULE_4___default","registerPartials","hbsRegisterPartials","path__WEBPACK_IMPORTED_MODULE_5___default","join","__dirname","set","use","_middleware__WEBPACK_IMPORTED_MODULE_9__","on","socket","log","_socketEvent__WEBPACK_IMPORTED_MODULE_8__","req","res","next","flashes","flash","locals","user","keys","length","undefined","userSchema","external_mongoose_default","Schema","local","email","type","String","unique","sparse","trim","lowercase","validate","isEmail_default","password","minlength","username","match","facebook","id","token","displayName","twitter","google","methods","[object Object]","plaintextPassword","Error","external_bcrypt_default","hash","compare","this","pre","async","hashPassword","plugin","external_mongoose_beautiful_unique_validation_default","model","__webpack_exports__","connect","process","env","DB_URL","validation","string","generateMessage","from","text","createdAt","external_moment_default","valueOf","socketEvent_users","instance","createInstance","users","room","push","userToRemove","assign","getUser","filter","find","map","Set","getInstance","updateUserJoining","emit","rooms","getRoomList","createLocationMessage","coords","to","latitude","longitude","url","generateLocationMessage","joinRoom","params","callback","toLowerCase","removeUser","addUser","getUserList","broadcast","createMessage","disconnect","_","catchAsyncError","fn","user_controller_User","validateNewUser","check_","in","isLength","errorMessage","options","min","matches","isEmail","normalizeEmail","all_lowercase","gmail_convert_googlemaildotcom","gmail_remove_dots","gmail_remove_subaddress","password-confirm","custom","body","errors","formatWith","msg","isEmpty","array","onlyFirstError","render","user_controller","createOne","save","login","redirect","getOne","findById","send","updateOne","docFromId","deleteOne","signupForm","userRouter","external_express_default","Router","user_router_User","param","Types","ObjectId","isValid","route","post","external_connect_ensure_login_","put","delete","auth_controller","loginForm","loginUser","external_passport_default","authenticate","successReturnToOrRedirect","failureRedirect","failureFlash","successFlash","logoutUser","logout","genOauthLogin","provider","config","requestPermission","scope","info","status","firstLogin","toUpperCase","substring","settings","connectedAccounts","User","findOne","profile","emails","authRouter","forEach","routes","title","validationErrors","e","static","path__WEBPACK_IMPORTED_MODULE_1___default","body_parser__WEBPACK_IMPORTED_MODULE_2___default","json","urlencoded","extended","express_session__WEBPACK_IMPORTED_MODULE_4___default","secret","SESSION_SECRET","resave","saveUninitialized","passport__WEBPACK_IMPORTED_MODULE_3___default","initialize","session","connect_flash__WEBPACK_IMPORTED_MODULE_5___default","mongoose__WEBPACK_IMPORTED_MODULE_5___default","passport__WEBPACK_IMPORTED_MODULE_0___default","passport_local__WEBPACK_IMPORTED_MODULE_1___default","usernameField","done","local.email","isValidPassword","genUniqueUsername","snakeCase","replace","usernameRegex","RegExp","usernames","newUsername","lodash__WEBPACK_IMPORTED_MODULE_6___default","genOauth2VerifyCallback","accessToken","refreshToken","passport_facebook__WEBPACK_IMPORTED_MODULE_2___default","clientID","FACEBOOK_APP_ID","clientSecret","FACEBOOK_APP_SECRET","callbackURL","DOMAIN","profileFields","passport_twitter__WEBPACK_IMPORTED_MODULE_3___default","consumerKey","TWITTER_CONSUMER_KEY","consumerSecret","TWITTER_CONSUMER_SECRET","tokenSecret","twitter.id","passport_google_oauth__WEBPACK_IMPORTED_MODULE_4__","GOOGLE_APP_ID","GOOGLE_APP_SECRET","serializeUser","deserializeUser","_server__WEBPACK_IMPORTED_MODULE_0__","port","PORT","listen"],"mappings":"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","file":"server.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 29);\n","module.exports = require(\"passport\");","module.exports = require(\"mongoose\");","module.exports = require(\"express\");","module.exports = require(\"path\");","module.exports = require(\"hbs\");","/* eslint-disable no-console */\n\nimport express from 'express';\nimport http from 'http';\nimport socketIO from 'socket.io';\nimport hbs from 'hbs';\nimport hbsUtilities from 'hbs-utils';\nimport path from 'path';\n\nimport connect from './db';\nimport './passport';\nimport genSocketEvents from './socketEvent';\nimport globalMiddleware from './middleware';\nimport routes from './routes';\n\nconst app = express();\nconst server = http.createServer(app);\nconst io = socketIO(server);\nconnect().catch(err => console.error('Could not connect to DB', err.message));\n\nhbs.localsAsTemplateData(app);\nhbs.registerHelper('toJSON', obj => JSON.stringify(obj, null, 2));\nconst hbsUtils = hbsUtilities(hbs);\nlet hbsRegisterPartials = hbsUtils.registerPartials.bind(hbsUtils);\nlet hbsRegisterPartialsOpt = {};\nif (process.env.NODE_ENV === 'development') {\n  hbsRegisterPartials = hbsUtils.registerWatchedPartials.bind(hbsUtils);\n  hbsRegisterPartialsOpt = {\n    onchange(template) { console.log(`hbs partial [${template}] added/changed`); },\n  };\n}\nhbsRegisterPartials(path.join(__dirname, '../views/partials'), hbsRegisterPartialsOpt);\napp.set('view engine', 'hbs');\n\napp.use(globalMiddleware);\n\nio.on('connection', (socket) => {\n  console.log('New user connected');\n  genSocketEvents(socket, io);\n});\n\n// pass variables to all templates\napp.use((req, res, next) => {\n  const flashes = req.flash();\n  res.locals.user = req.user;\n  res.locals.flashes = Object.keys(flashes).length > 0 ? flashes : undefined;\n  next();\n});\napp.use('/', routes);\n\nexport { server as default, io };\n","module.exports = require(\"express-validator/check\");","module.exports = require(\"body-parser\");","module.exports = require(\"moment\");","module.exports = require(\"bcrypt\");","import mongoose from 'mongoose';\nimport bcrypt from 'bcrypt';\nimport isEmail from 'validator/lib/isEmail';\nimport beautifyUnique from 'mongoose-beautiful-unique-validation';\n\nconst userSchema = new mongoose.Schema({\n  local: {\n    email: {\n      type: String,\n      unique: 'An account with email {VALUE} already exists',\n      sparse: true, // allows us to add documents without unique fields\n      trim: true,\n      lowercase: true,\n      validate: [isEmail, 'Email is not valid'],\n    },\n    password: {\n      type: String,\n      trim: true,\n      minlength: 5,\n    },\n    username: {\n      type: String,\n      // required: 'Username is required',\n      unique: 'Username already taken',\n      sparse: true,\n      lowercase: true,\n      trim: true,\n      match: [/^[\\w-]+$/, \"Username must contain alphanumeric, '-', '_' characters only\"],\n    },\n  },\n  facebook: {\n    id: String,\n    token: String,\n    displayName: String,\n    email: String,\n  },\n  twitter: {\n    id: String,\n    token: String,\n    displayName: String,\n    username: String,\n  },\n  google: {\n    id: String,\n    token: String,\n    displayName: String,\n    email: String,\n  },\n});\n\nuserSchema.methods = {\n  hashPassword(plaintextPassword) {\n    if (!plaintextPassword) {\n      throw new Error('Password cannot be blank');\n    }\n    return bcrypt.hash(plaintextPassword, 12);\n  },\n  isValidPassword(password) {\n    return bcrypt.compare(password, this.local.password);\n  },\n};\n\nuserSchema.pre('save', async function preSaveUser(next) {\n  if (this.local.password) { // password might not be supplied if logging in via oauth\n    this.local.password = await this.hashPassword(this.local.password);\n  }\n  next();\n});\n\n// if client tries creating a duplicate on a unique field, it will produce a low level\n// mongo db error. This plugin transforms that error into a mongoose validation error\n// that exists in an 'errors' object\nuserSchema.plugin(beautifyUnique);\n\nexport default mongoose.model('User', userSchema);\n","import mongoose from 'mongoose';\nimport './models';\n\nconst connect = async () => mongoose.connect(process.env.DB_URL);\n\nexport default connect;\n\n","const isRealString = string => typeof string === 'string' && string.trim().length > 0;\n\nexport default isRealString;\n","import moment from 'moment';\n\nexport const generateMessage = (from, text) => ({\n  from,\n  text,\n  createdAt: moment().valueOf(),\n});\n\nexport const generateLocationMessage = (from, latitude, longitude) => ({\n  from,\n  url: `https://www.google.com/maps?q=${latitude},${longitude}`,\n  createdAt: moment().valueOf(),\n});\n","import isRealString from './utils/validation';\nimport { generateMessage, generateLocationMessage } from './utils/message';\nimport Users from './utils/users';\n\nconst users = Users.getInstance();\n\n// update room list for people joining a room\nconst updateUserJoining = (io) => {\n  io.emit('updateRoomList', { rooms: users.getRoomList() });\n};\n\nconst joinRoom = (socket, io) => socket.on('join', (params, callback) => {\n  if (!isRealString(params.name) || !isRealString(params.room)) {\n    return callback('Name and Room name are required!');\n  }\n\n  const name = params.name.trim();\n  const room = params.room.trim().toLowerCase();\n  const user = users.getUser({ name });\n\n  if (user && user.room === room) {\n    return callback('Username taken!');\n  }\n\n  socket.join(room);\n  users.removeUser(socket.id);\n  users.addUser(socket.id, name, room);\n  io.to(room).emit('updateUserList', users.getUserList(room));\n  socket.emit('newMessage', generateMessage('Admin', `Welcome to the room ${room}!`));\n  socket.broadcast.to(room).emit('newMessage', generateMessage('Admin', `${name} joined the chat`));\n\n  updateUserJoining(io);\n  return callback();\n});\n\nconst createMessage = (socket, io) => socket.on('createMessage', (message, callback) => {\n  const user = users.getUser({ id: socket.id });\n\n  if (user && isRealString(message.text)) {\n    io.to(user.room).emit('newMessage', generateMessage(user.name, message.text));\n  }\n  callback();\n});\n\nconst createLocationMessage = (socket, io) => socket.on('createLocationMessage', (coords) => {\n  const user = users.getUser({ id: socket.id });\n\n  if (user) {\n    io.to(user.room).emit('newLocationMessage', generateLocationMessage(user.name, coords.latitude, coords.longitude));\n  }\n});\n\nconst disconnect = (socket, io) => socket.on('disconnect', () => {\n  const user = users.removeUser(socket.id);\n\n  io.to(user.room).emit('updateUserList', users.getUserList(user.room));\n  io.to(user.room).emit('newMessage', generateMessage('Admin', `${user.name} has left`));\n  updateUserJoining(io);\n});\n\nconst getRoomList = socket => socket.on('getRoomList', (_, callback) => {\n  callback({ rooms: users.getRoomList() });\n});\n\nexport default (socket, io) => ({\n  joinRoom: joinRoom(socket, io),\n  createMessage: createMessage(socket, io),\n  createLocationMessage: createLocationMessage(socket, io),\n  disconnect: disconnect(socket, io),\n  getRoomList: getRoomList(socket, io),\n});\n","class UsersClass {\n  constructor() {\n    this.users = [];\n  }\n\n  addUser(id, name, room) {\n    const user = { id, name, room };\n    this.users.push(user);\n    return user;\n  }\n\n  removeUser(id) {\n    const userToRemove = Object.assign({}, this.getUser({ id }));\n\n    if (userToRemove) {\n      this.users = this.users.filter(user => user.id !== userToRemove.id);\n    }\n\n    return userToRemove;\n  }\n\n  getUser({ id, name }) {\n    return this.users.find(user => user.id === id || user.name === name);\n  }\n\n  getUserList(room) {\n    const users = this.users.filter(user => user.room === room);\n    const namesArray = users.map(user => user.name);\n\n    return namesArray;\n  }\n\n  getRoomList() {\n    const rooms = new Set(this.users.map(user => user.room));\n    return [...rooms];\n  }\n}\n\nconst Users = (() => {\n  let instance;\n\n  const createInstance = () => new UsersClass();\n\n  return {\n    getInstance() {\n      if (!instance) {\n        instance = createInstance();\n      }\n      return instance;\n    },\n  };\n})();\n\nexport default Users;\nexport { UsersClass };\n","export const catchAsyncError = fn => (req, res, next) => fn(req, res, next).catch(next);\n","import mongoose from 'mongoose';\nimport { checkSchema, validationResult } from 'express-validator/check';\n\nimport { catchAsyncError } from '../utils/helpers';\n\nconst User = mongoose.model('User');\n\nconst signupForm = (req, res) => {\n  res.render('signup');\n};\n\nconst validateNewUser = [\n  checkSchema({\n    username: {\n      in: 'body',\n      isLength: {\n        errorMessage: 'Username must not be empty',\n        options: { min: 1 },\n      },\n      matches: {\n        errorMessage: \"Username must be letters, numbers, '_', '-' only\",\n        options: /^[\\w-]+$/,\n      },\n      trim: true,\n    },\n    email: {\n      in: 'body',\n      isEmail: {\n        errorMessage: 'Email address is not valid',\n      },\n      trim: true,\n      normalizeEmail: {\n        options: {\n          all_lowercase: true,\n          gmail_convert_googlemaildotcom: true,\n          gmail_remove_dots: true,\n          gmail_remove_subaddress: true,\n        },\n      },\n    },\n    password: {\n      in: 'body',\n      isLength: {\n        errorMessage: 'Password must be at least 5 characters long',\n        options: { min: 5 },\n      },\n      trim: true,\n    },\n    'password-confirm': {\n      in: 'body',\n      custom: {\n        options: (value, { req }) => {\n          if (req.body.password !== value) {\n            throw new Error('Password confirmation does not match password field');\n          }\n          return true;\n        },\n      },\n    },\n  }),\n  (req, res, next) => {\n    const errors = validationResult(req).formatWith(({ msg }) => msg);\n    if (errors.isEmpty()) {\n      next();\n    } else {\n      req.flash('error', errors.array({ onlyFirstError: true }));\n      res.render('signup', { body: req.body, flashes: req.flash() });\n    }\n  }];\n\nconst createOne = async (req, res, next) => {\n  const { email, password, username } = req.body;\n  const user = new User({ local: { email, password, username } });\n  try {\n    await user.save();\n    req.login(user, next);\n    req.flash('success', 'New account created!');\n    res.redirect('/');\n  } catch (err) {\n    if (err.errors) {\n      const keys = Object.keys(err.errors);\n      const flashes = keys.map(key => err.errors[key].message);\n      req.flash('error', flashes);\n      res.render('signup', { body: { username, email }, flashes: req.flash() });\n    } else {\n      next(err);\n    }\n  }\n};\n\nconst getOne = async (req, res) => {\n  const user = await User.findById(req.user.id);\n  res.send(`get user\\n ${user}`);\n};\n\nconst updateOne = (req, res) => {\n  res.send(`update user\\n ${req.docFromId}`);\n};\n\nconst deleteOne = (req, res) => {\n  res.send(`delete user\\n ${req.docFromId}`);\n};\n\nexport default {\n  createOne,\n  getOne: catchAsyncError(getOne),\n  updateOne: catchAsyncError(updateOne),\n  deleteOne: catchAsyncError(deleteOne),\n  signupForm,\n  validateNewUser,\n};\n","import express from 'express';\nimport { ensureLoggedIn } from 'connect-ensure-login';\nimport mongoose from 'mongoose';\nimport userController from '../controllers/user.controller';\n\nexport const userRouter = express.Router();\nconst User = mongoose.model('User');\n\nuserRouter.param('id', async (req, res, next, id) => {\n  try {\n    if (!mongoose.Types.ObjectId.isValid(id)) {\n      throw new Error('Invalid user id');\n    }\n    const user = await User.findById(id);\n    if (!user) {\n      throw new Error('No user found');\n    } else {\n      req.docFromId = user;\n      next();\n    }\n  } catch (err) {\n    next(err.message);\n  }\n});\n\nuserRouter.route('/signup')\n  .get(userController.signupForm)\n  .post(userController.validateNewUser, userController.createOne);\n\nuserRouter.route('/user/:id')\n  .get(ensureLoggedIn(), userController.getOne)\n  .put(userController.updateOne)\n  .delete(userController.deleteOne);\n","import passport from 'passport';\n\nconst loginForm = (req, res) => {\n  res.render('login');\n};\n\nconst loginUser = passport.authenticate('local', {\n  successReturnToOrRedirect: '/',\n  failureRedirect: '/login',\n  failureFlash: true,\n  successFlash: true,\n});\n\nconst logoutUser = (req, res) => {\n  req.logout();\n  req.flash('info', 'You have logged out');\n  res.redirect('/');\n};\n\nconst genOauthLogin = (provider, config) => ({\n  requestPermission() {\n    if (config.scope) {\n      return passport.authenticate(provider, { scope: config.scope });\n    }\n    return passport.authenticate(provider);\n  },\n  callback(req, res, next) {\n    passport.authenticate(provider, (err, user, info, status) => {\n      if (err) { return next(err); }\n      if (!user) {\n        req.flash('error', `You did not give permission to login with ${provider[0].toUpperCase() + provider.substring(1)}`);\n        return res.redirect('/login');\n      }\n\n      return req.login(user, (error) => {\n        if (error) { return next(error); }\n        req.flash('success', `You have logged in, ${user[provider].displayName || user[provider].username}`);\n        if (user.firstLogin) { return res.redirect('/settings'); }\n        return res.redirect('/');\n      });\n    })(req, res, next);\n  },\n});\n\nconst settings = async (req, res) => {\n  // if logging in for first time, show settings page. else, just redirect to home page.\n  const connectedAccounts = [];\n  if (req.user.email) {\n    const localAccount = await User.findOne({ email: profile.emails[0].value });\n    if (localAccount) {\n      connectedAccounts.push({ type: 'local', email });\n    }\n  }\n  // if (req.user.facebookId && profile.provider) {\n\n  // }\n  res.send('this be settings');\n};\n\nexport default {\n  loginForm, loginUser, logoutUser, genOauthLogin, settings,\n};\n","import express from 'express';\n\nimport authController from '../controllers/auth.controller';\nimport { catchAsyncError } from '../utils/helpers';\n\nexport const authRouter = express.Router();\n\nauthRouter.get('/login', authController.loginForm);\nauthRouter.post('/login', authController.loginUser);\nauthRouter.get('/logout', authController.logoutUser);\nauthRouter.get('/settings', catchAsyncError(authController.settings));\n\n((providers) => {\n  providers.forEach(({ provider, config = {} }) => {\n    const { requestPermission, callback } = authController.genOauthLogin(provider, config);\n    authRouter.get(`/login/${provider}`, requestPermission());\n    authRouter.get(`/login/${provider}/callback`, callback);\n  });\n})([\n  {\n    provider: 'facebook',\n    config: {\n      scope: 'email',\n    },\n  },\n  { provider: 'twitter' },\n  {\n    provider: 'google',\n    config: {\n      scope: 'https://www.googleapis.com/auth/userinfo.profile',\n    },\n  },\n]);\n","import express from 'express';\nimport { userRouter } from './user.router';\nimport { authRouter } from './auth.router';\n\nconst routes = express.Router();\n\nroutes.use('/', authRouter);\nroutes.use('/', userRouter);\n\nroutes.get('/', (req, res) => {\n  res.render('index', { title: 'Join' });\n});\n\nroutes.post('/chat', (req, res) => {\n  res.render('chat', { title: 'Chat' });\n});\n\n// handle mongoose validation errors\nroutes.use((err, req, res, next) => {\n  if (!err.errors) {\n    return next(err);\n  }\n\n  const validationErrors = Object.keys(err.errors);\n\n  if (validationErrors.length > 0) {\n    validationErrors.forEach(e => req.flash('error', err.errors[e].message));\n  }\n  return res.redirect('back');\n});\n\nroutes.use((err, req, res, next) => { // eslint-disable-line no-unused-vars\n  res.status(500).send(`something messed up: ${err.message}`);\n});\n\nexport default routes;\n","module.exports = require(\"connect-ensure-login\");","module.exports = require(\"connect-flash\");","module.exports = require(\"express-session\");","import express from 'express';\nimport path from 'path';\nimport bodyParser from 'body-parser';\nimport passport from 'passport';\nimport session from 'express-session';\nimport flash from 'connect-flash';\n\nexport default [\n  express.static(path.join(__dirname, '../public')),\n  bodyParser.json(),\n  bodyParser.urlencoded({ extended: true }),\n  session({ secret: process.env.SESSION_SECRET, resave: false, saveUninitialized: false }),\n  passport.initialize(),\n  passport.session(),\n  flash(),\n];\n","module.exports = require(\"lodash\");","module.exports = require(\"passport-google-oauth\");","module.exports = require(\"passport-twitter\");","module.exports = require(\"passport-facebook\");","module.exports = require(\"passport-local\");","module.exports = require(\"mongoose-beautiful-unique-validation\");","module.exports = require(\"validator/lib/isEmail\");","module.exports = require(\"hbs-utils\");","module.exports = require(\"socket.io\");","module.exports = require(\"http\");","import passport from 'passport';\nimport LocalStrategy from 'passport-local';\nimport FacebookStrategy from 'passport-facebook';\nimport TwitterStrategy from 'passport-twitter';\nimport { OAuth2Strategy as GoogleStrategy } from 'passport-google-oauth';\nimport mongoose from 'mongoose';\nimport _ from 'lodash';\n\nconst User = mongoose.model('User');\n\npassport.use(new LocalStrategy({ usernameField: 'email' }, async (email, password, done) => {\n  try {\n    const user = await User.findOne({ 'local.email': email });\n    if (!user) {\n      return done(null, false, { message: 'User or password is invalid' });\n    }\n\n    const isValidPassword = await user.isValidPassword(password);\n    if (!isValidPassword) {\n      return done(null, false, { message: 'User or password is invalid' });\n    }\n\n    return done(null, user, { message: `You have logged in, ${user.local.username}` });\n  } catch (err) {\n    return done(err, null, { message: 'Could not authenticate. Please try again' });\n  }\n}));\n\nconst genUniqueUsername = async (name) => {\n  if (!name) { return undefined; }\n  const snakeCase = name.toLowerCase().replace(/ /g, '_');\n  const usernameRegex = new RegExp(`^${snakeCase}\\d*$`);\n  const usernames = await User.find({ username: usernameRegex }, 'username');\n  let newUsername = snakeCase;\n  // find the first unique username with format username<incrementing number>\n  for (let i = 0; _.find(usernames, { username: newUsername }); i += 1) {\n    newUsername = snakeCase + (usernames.length + i);\n  }\n  return newUsername;\n};\n\nconst genOauth2VerifyCallback = provider => async (accessToken, refreshToken, profile, done) => {\n  try {\n    let user = await User.findOne({ [`${provider}.id`]: profile.id });\n    if (user) {\n      return done(null, user);\n    }\n\n    let email;\n    if (profile.emails && profile.emails.length) {\n      email = profile.emails[0].value;\n    }\n    user = await User.create({\n      [provider]: {\n        id: profile.id,\n        username: await genUniqueUsername(profile.username),\n        displayName: profile.displayName,\n        token: accessToken,\n        email,\n      },\n    });\n    user.firstLogin = true;\n    return done(null, user);\n  } catch (err) {\n    return done(err, false, { message: 'Could not authenticate. Please try again' });\n  }\n};\n\npassport.use(new FacebookStrategy(\n  {\n    clientID: process.env.FACEBOOK_APP_ID,\n    clientSecret: process.env.FACEBOOK_APP_SECRET,\n    callbackURL: `${process.env.DOMAIN}/login/facebook/callback`,\n    profileFields: ['email', 'displayName'],\n  },\n  genOauth2VerifyCallback('facebook'),\n));\n\npassport.use(new TwitterStrategy(\n  {\n    consumerKey: process.env.TWITTER_CONSUMER_KEY,\n    consumerSecret: process.env.TWITTER_CONSUMER_SECRET,\n    callbackURL: `${process.env.DOMAIN}/login/twitter/callback`,\n  },\n  async (token, tokenSecret, profile, done) => {\n    try {\n      let user = await User.findOne({ 'twitter.id': profile.id });\n\n      if (user) {\n        return done(null, user, { message: `You have logged in, ${user.twitter.username}` });\n      }\n\n      user = await User.create({\n        twitter: {\n          id: profile.id,\n          token,\n          username: await genUniqueUsername(profile.username),\n          displayName: profile.displayName,\n        },\n      });\n\n      return done(null, user, { message: `You have logged in, ${user.twitter.username}` });\n    } catch (err) {\n      return done(err, false, { message: 'Could not authenticate. Please try again' });\n    }\n  },\n));\n\npassport.use(new GoogleStrategy(\n  {\n    clientID: process.env.GOOGLE_APP_ID,\n    clientSecret: process.env.GOOGLE_APP_SECRET,\n    callbackURL: `${process.env.DOMAIN}/login/google/callback`,\n  },\n  genOauth2VerifyCallback('google'),\n));\n\npassport.serializeUser((user, done) => done(null, user.id));\npassport.deserializeUser(async (id, done) => {\n  try {\n    const user = await User.findById(id);\n    return done(null, user);\n  } catch (err) {\n    return done(err);\n  }\n});\n","/* eslint-disable no-console */\n\nimport server, { io } from './server';\n\nconst port = process.env.PORT || 4000;\nlet cServer = server;\nlet cIo = io;\n\nif (module.hot) {\n  module.hot.accept('./server', () => {\n    console.log('Re-attaching event listeners to updated server module');\n    cServer.close();\n    server.listen(port);\n    cServer = server;\n\n    cIo.close();\n    io.attach(cServer);\n    cIo = io;\n  });\n}\n\nserver.listen(port, () => {\n  console.log(`Server started on port ${port}`);\n});\n"],"sourceRoot":""}