!function(e){var r={};function t(s){if(r[s])return r[s].exports;var a=r[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=e,t.c=r,t.d=function(e,r,s){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:s})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(t.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)t.d(s,a,function(r){return e[r]}.bind(null,a));return s},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=28)}([function(e,r){e.exports=require("mongoose")},function(e,r){e.exports=require("passport")},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("lodash")},function(e,r){e.exports=require("path")},function(e,r,t){"use strict";(function(e){var s=t(16),a=t.n(s),o=t(4),n=t.n(o);const i=new a.a({message:{from:"no-reply@timiscoding.me"},transport:{port:process.env.MAILER_PORT,host:process.env.MAILER_HOST,auth:{user:process.env.MAILER_USERNAME,pass:process.env.MAILER_PASSWORD}},juice:!0,juiceResources:{webResources:{relativeTo:n.a.join(e,"../views/emails/build")}},views:{root:n.a.join(e,"../views/emails")}});r.a=i}).call(this,"/Users/tim/Work/misc/complete-node/node-chat-app/server")},function(e,r){e.exports=require("crypto")},function(e,r){e.exports=require("express-validator/check")},function(e,r){e.exports=require("express-session")},function(e,r){e.exports=require("body-parser")},function(e,r,t){"use strict";(function(e){t.d(r,"b",function(){return y});var s=t(2),a=t.n(s),o=t(4),n=t.n(o),i=t(9),c=t.n(i),l=t(1),u=t.n(l),d=t(8),m=t.n(d),p=t(15),f=t.n(p),g=t(0),h=t.n(g);const w={secret:process.env.SESSION_SECRET,resave:!1,saveUninitialized:!1};{const e=t(27)(m.a);w.store=new e({mongooseConnection:h.a.connection,autoRemove:"native"})}const y=m()(w);r.a=[a.a.static(n.a.join(e,"../public")),c.a.json(),c.a.urlencoded({extended:!0}),y,u.a.initialize(),u.a.session(),f()()]}).call(this,"/Users/tim/Work/misc/complete-node/node-chat-app/server")},function(e,r){e.exports=require("moment")},function(e,r){e.exports=require("bcrypt")},function(e,r){e.exports=require("request-promise")},function(e,r){e.exports=require("connect-ensure-login")},function(e,r){e.exports=require("connect-flash")},function(e,r){e.exports=require("email-templates")},function(e,r){e.exports=require("passport-google-oauth")},function(e,r){e.exports=require("passport-twitter")},function(e,r){e.exports=require("passport-facebook")},function(e,r){e.exports=require("passport-local")},function(e,r){e.exports=require("mongoose-beautiful-unique-validation")},function(e,r){e.exports=require("validator/lib/isEmail")},function(e,r){e.exports=require("es6-promisify")},function(e,r){e.exports=require("socket.io")},function(e,r){e.exports=require("http")},function(e,r,t){"use strict";t.r(r);var s=t(2),a=t.n(s),o=t(25),n=t.n(o),i=t(24),c=t.n(i),l=t(23),u=t(0),d=t.n(u),m=t(12),p=t.n(m),f=t(22),g=t.n(f),h=t(21),w=t.n(h),y=t(3),v=t.n(y);const b=new d.a.Schema({username:{type:String,required:"Username is required",unique:"Username already taken",sparse:!0,lowercase:!0,trim:!0,match:[/^[\w-]+$/,"Username must contain alphanumeric, '-', '_' characters only"]},local:{email:{type:String,unique:"An account with email {VALUE} already exists",sparse:!0,trim:!0,lowercase:!0,validate:[g.a,"Email is not valid"]},password:{type:String,trim:!0,minlength:5},isVerified:{type:Boolean,default:!1}},facebook:{id:String,token:String,displayName:String,email:String},twitter:{id:String,token:String,displayName:String,username:String},google:{id:String,token:String,displayName:String,email:String},passwordResetToken:String,passwordResetExpires:Date});b.methods.isValidPassword=function(e){return p.a.compare(e,this.local.password)};const k=["twitter","google","facebook","local"];b.methods.accountsTotal=function(){return Object.keys(this.toObject()).reduce((e,r)=>k.includes(r)&&("local"===r||"local"!==r&&this[r].token)?e+1:e,0)},b.statics.hashPassword=function(e){if(!e)throw new Error("Password cannot be blank");return p.a.hash(e,12)},b.statics.genUniqueUsername=async function(e="anon"){const r=e.toLowerCase().replace(/ /g,"_"),t=new RegExp(`^${r}d*$`),s=await this.find({username:t},"username");let a=r;for(let e=0;v.a.find(s,{username:a});e+=1)a=r+(s.length+e);return a},b.plugin(w.a);d.a.model("User",b);var E=t(6),O=t.n(E);const R=new d.a.Schema({user:{type:d.a.Schema.Types.ObjectId,ref:"User",required:!0},createdAt:{type:Date,expires:"5 min",default:Date.now},token:{type:String,required:!0}}),P=()=>O.a.randomBytes(20).toString("hex");R.statics.findOneOrCreate=async function(e){const r=this;if(e){return await r.findOne({user:e})||r.create({user:e,token:P()})}return new Error("User id not given")},R.statics.createToken=async function(e){return this.create({user:e,token:P()})};d.a.model("EmailVerifyToken",R);var S=async()=>d.a.connect(process.env.DB_URL),T=t(1),U=t.n(T),_=t(20),x=t.n(_),A=t(19),q=t.n(A),C=t(18),L=t.n(C),j=t(17);const I=d.a.model("User");U.a.use(new x.a({usernameField:"email",passReqToCallback:!0},async(e,r,t,s)=>{try{const e=await I.findOne({"local.email":r});return e&&await e.isValidPassword(t)?e.local.isVerified?s(null,e):s(null,!1,{message:'The email has not been verified for this account. <a href="/resend">Resend email confirmation</a>'}):s(null,!1,{message:"Email or password is invalid"})}catch(e){return s(e,null,{message:"Could not authenticate. Please try again"})}}));const $=e=>e.emails&&e.emails.length&&e.emails[0].value,M=async(e,r,t)=>I.create({[e]:{id:t.id,displayName:t.displayName,token:r,email:$(t)},username:await I.genUniqueUsername(t.username||t.displayName)}),F=e=>async(r,t,s,a,o)=>{try{let s=await I.findOne({[`${e}.id`]:a.id});return r.user?s?(s[e].token||(s=await M(e,t,a)),o(null,s)):o(null,s=await M(e,t,a)):s?(s[e].token||(s[e]={id:a.id,displayName:a.displayName,token:t,email:$(a)},s=await s.save()),o(null,s)):o(null,s=await M(e,t,a),{firstLogin:!0})}catch(e){return o(e,!1,{message:"Could not authenticate. Please try again"})}};U.a.use(new q.a({clientID:process.env.FACEBOOK_APP_ID,clientSecret:process.env.FACEBOOK_APP_SECRET,callbackURL:`${process.env.DOMAIN}/auth/facebook/callback`,profileFields:["email","displayName"],passReqToCallback:!0},F("facebook"))),U.a.use(new L.a({consumerKey:process.env.TWITTER_CONSUMER_KEY,consumerSecret:process.env.TWITTER_CONSUMER_SECRET,callbackURL:`${process.env.DOMAIN}/auth/twitter/callback`,passReqToCallback:!0},F("twitter"))),U.a.use(new j.OAuth2Strategy({clientID:process.env.GOOGLE_APP_ID,clientSecret:process.env.GOOGLE_APP_SECRET,callbackURL:`${process.env.DOMAIN}/auth/google/callback`,passReqToCallback:!0},F("google"))),U.a.serializeUser((e,r)=>r(null,e.id)),U.a.deserializeUser(async(e,r)=>{try{return r(null,await I.findById(e))}catch(e){return r(e)}});var N=t(5);var D=e=>"string"==typeof e&&e.trim().length>0,K=t(11),V=t.n(K);const B=(e,r)=>({from:e,text:r,createdAt:V()().valueOf()});var H=(()=>{let e;const r=()=>new class{constructor(){this.users=[]}addUser(e,r,t,s){const a={id:e,name:r,room:t,mongoId:s};return this.users.push(a),a}removeUser(e){const r=Object.assign({},this.getUser({id:e}));return r&&(this.users=this.users.filter(e=>e.id!==r.id)),r}getUser({id:e,name:r}){return this.users.find(t=>t.id===e||t.name===r)}getUserList(e){return this.users.filter(r=>r.room===e).map(e=>e.name)}getRoomList(){return[...new Set(this.users.map(e=>e.room))]}};return{getInstance:()=>(e||(e=r()),e)}})();const Y=new d.a.Schema({name:{type:String,required:!0,minLength:1,trim:!0}});var G=d.a.model("Room",Y);const z=new d.a.Schema({createdAt:{type:Date,default:Date.now},to:{type:String,index:!0,required:!0},from:{type:d.a.Schema.Types.ObjectId,ref:"User",required:!0},content:{type:String,trim:!0,minLength:1,required:!0}});var W=d.a.model("Message",z);const J=H.getInstance(),Q=d.a.model("User"),X=e=>{e.emit("updateRoomList",{rooms:J.getRoomList()})},Z=(e,r)=>e.on("createLocationMessage",t=>{const s=J.getUser({id:e.id});s&&r.to(s.room).emit("newLocationMessage",((e,r,t)=>({from:e,url:`https://www.google.com/maps?q=${r},${t}`,createdAt:V()().valueOf()}))(s.name,t.latitude,t.longitude))});var ee=(e,r)=>({joinRoom:((e,r)=>e.on("join",async(t,s)=>{if(!D(t.room))return s("Room name required!");const a=t.room.trim().toLowerCase();e.join(a);const{passport:o}=e.handshake.session;let n,i,c;if(o&&o.user)try{const e=await Q.findById(o.user);n=e.username,i=e.id}catch(e){return s("Could not retrieve user information")}else{const e=new d.a.Types.ObjectId;n=`guest-${e.toString().slice(-4)}`,await Q.create({username:n,_id:e}),i=e.toString()}try{await G.findOne({name:a})||await G.create({name:a})}catch(e){return s("Could not create room")}try{c=await W.find({to:a},{_id:0},{sort:{createdAt:1}}).populate("from",{username:1,_id:0})}catch(e){return s("Could not get message history")}return J.removeUser(e.id),J.addUser(e.id,n,a,i),r.to(a).emit("updateUserList",J.getUserList(a)),e.emit("newMessage",B("Admin",`Welcome to the room ${a}!`)),e.broadcast.to(a).emit("newMessage",B("Admin",`${n} joined the chat`)),X(r),s(null,c)}))(e,r),createMessage:((e,r)=>e.on("createMessage",async(t,s)=>{const a=J.getUser({id:e.id});if(a&&D(t.text)){try{await W.create({from:a.mongoId,to:a.room,content:t.text})}catch(e){return s("Error persisting message to db")}r.to(a.room).emit("newMessage",B(a.name,t.text))}s()}))(e,r),createLocationMessage:Z(e,r),disconnect:((e,r)=>e.on("disconnect",()=>{const t=J.removeUser(e.id);r.to(t.room).emit("updateUserList",J.getUserList(t.room)),r.to(t.room).emit("newMessage",B("Admin",`${t.name} has left`)),X(r)}))(e,r),getRoomList:(e=>e.on("getRoomList",(e,r)=>{r({rooms:J.getRoomList()})}))(e)}),re=t(10),te=t(14),se=t(13),ae=t.n(se),oe=t(7);const ne={username:{in:"body",isLength:{errorMessage:"Username must not be empty",options:{min:1}},custom:{options:e=>{if(!/^[\w-]+$/.test(e))throw new Error("Username must be letters, numbers, '_', ' -' only");if(/^guest-\w+$/i.test(e))throw new Error("Usernames beginning with 'guest-' are reserved for unregistered users");return!0}},trim:!0},email:{in:"body",isEmail:{errorMessage:"Email address is not valid"},trim:!0,normalizeEmail:{options:{all_lowercase:!0,gmail_convert_googlemaildotcom:!0,gmail_remove_dots:!0,gmail_remove_subaddress:!0}}},password:{in:"body",isLength:{errorMessage:"Password must be at least 5 characters long",options:{min:5}},trim:!0},"password-confirm":{in:"body",custom:{options:(e,{req:r})=>{if(r.body.password!==e)throw new Error("Password confirmation does not match password field");return!0}}}},ie=(...e)=>e.length?v.a.pick(ne,e):ne,ce=(e,r)=>[Object(oe.checkSchema)(e),(e,t,s)=>{const a=Object(oe.validationResult)(e).formatWith(({msg:e})=>e);a.isEmpty()?s():(e.flash("error",a.array({onlyFirstError:!0})),t.render(r,{body:e.body,flashes:e.flash(),recaptchaKey:process.env.G_RECAPTCHA_SITE_KEY}))}],le=e=>(r,t,s)=>e(r,t,s).catch(s),ue=d.a.model("User"),de=d.a.model("EmailVerifyToken"),me=ce(ie(),"signup"),pe=ce(ie("email"),"confirmEmail"),fe=ce(ie("password","password-confirm"),"resetPassword");var ge={createOne:le(async(e,r,t)=>{const{email:s,password:a,username:o}=e.body;try{const n=await ue.create({local:{email:s,password:await ue.hashPassword(a)},username:o});e.emailToken=await de.createToken(n.id),t()}catch(a){if(a.errors){const t=Object.keys(a.errors).map(e=>a.errors[e].message);e.flash("error",t),r.render("signup",{body:{username:o,email:s},flashes:e.flash()})}else t(a)}}),getOne:le(async(e,r)=>{const t=await ue.findById(e.user.id);r.send(`get user\n ${t}`)}),updateOne:le((e,r)=>{r.send(`update user\n ${e.docFromId}`)}),deleteOne:le((e,r)=>{r.send(`delete user\n ${e.docFromId}`)}),signupForm:(e,r)=>{r.render("signup",{recaptchaKey:process.env.G_RECAPTCHA_SITE_KEY})},validateNewUser:me,confirmEmail:le(async(e,r)=>{const t=await de.findOneAndRemove({token:e.params.token}).populate("user");if(!t)return e.flash("error",'Email verification invalid. Either the link does not match the one provided\n      in the email or the link may have expired. <a href="/resend">Resend email confirmation</a>'),r.redirect("/");const{user:s}=t;return s.local.isVerified=!0,await s.save(),await e.login(s),e.flash("success","Your email has been confirmed. You are now logged in"),r.redirect("/")}),requestResend:(e,r)=>{r.render("confirmEmail",{recaptchaKey:process.env.G_RECAPTCHA_SITE_KEY})},validateEmail:pe,resend:async(e,r,t)=>{const s=await ue.findOne({"local.email":e.body.email});return s&&s.local?s.local&&s.local.isVerified?(e.flash("info","The email for this account is already confirmed"),r.redirect("/")):(e.emailToken=await de.findOneOrCreate(s.id),e.body.username=s.username,t()):(e.flash("info","An account with this email does not exist"),r.render("confirmEmail",{body:e.body,flashes:e.flash()}))},sendConfirmEmail:(e,r)=>{const{email:t,username:s}=e.body;N.a.send({template:"verifyEmail",message:{to:t},locals:{name:s,confirmURL:`${e.protocol}://${e.hostname}/confirm/${e.emailToken.token}`}}),e.flash("info",`An email has been sent to ${t}. Please confirm your email to complete sign up.`),r.redirect("/")},forgotPasswordForm:(e,r)=>{r.render("forgotPassword",{recaptchaKey:process.env.G_RECAPTCHA_SITE_KEY})},forgotPassword:le(async(e,r,t)=>{const s=await ue.findOne({"local.email":e.body.email});return s&&s.local?(s.passwordResetToken=O.a.randomBytes(20).toString("hex"),s.passwordResetExpires=Date.now()+36e5,await s.save(),e.emailToken=s.passwordResetToken,e.body.username=s.username,t()):(e.flash("info","An account with this email does not exist"),r.render("forgotPassword",{body:e.body,flashes:e.flash()}))}),sendResetEmail:(e,r)=>{const{email:t,username:s}=e.body;N.a.send({template:"resetPassword",message:{to:t},locals:{name:s,resetURL:`${e.protocol}://${e.hostname}/reset/${e.emailToken}`}}),e.flash("info",`An email has been sent to ${t} with instructions to reset your password.`),r.redirect("/")},resetPasswordForm:async(e,r)=>{r.render("resetPassword")},validatePassword:fe,resetPassword:le(async(e,r,t)=>{const{user:s}=e;s.local.password=await ue.hashPassword(e.body.password),s.passwordResetExpires=void 0,s.passwordResetToken=void 0,await s.save(),await e.login(s),t()}),validResetToken:le(async(e,r,t)=>{const s=await ue.findOne({passwordResetToken:e.params.token,passwordResetExpires:{$gt:Date.now()}});return s?(e.user=s,t()):(e.flash("error","This password reset is invalid or expired. Please request a new one"),r.redirect("/forgot"))}),sendPasswordUpdatedEmail:le(async(e,r)=>{const{local:{email:t},username:s}=e.user;N.a.send({template:"updatedPassword",message:{to:t},locals:{name:s}}),e.flash("success","Password has been updated"),r.redirect("/")}),validateHuman:e=>async(r,t,s)=>{const a={method:"POST",uri:"https://www.google.com/recaptcha/api/siteverify",formData:{secret:process.env.G_RECAPTCHA_SECRET,response:r.body["g-recaptcha-response"]},json:!0};try{if((await ae()(a)).success)return s()}catch(e){return s(e)}return r.flash("error","reCaptcha failed. Please try again"),t.render(e,{body:r.body,flashes:r.flash(),recaptchaKey:process.env.G_RECAPTCHA_SITE_KEY})}};const he=a.a.Router(),we=d.a.model("User");he.param("id",async(e,r,t,s)=>{try{if(!d.a.Types.ObjectId.isValid(s))throw new Error("Invalid user id");const r=await we.findById(s);if(!r)throw new Error("No user found");e.docFromId=r,t()}catch(e){t(e.message)}}),he.route("/signup").get(ge.signupForm).post(ge.validateNewUser,ge.validateHuman("signup"),ge.createOne,ge.sendConfirmEmail),he.route("/user/:id").get(Object(te.ensureLoggedIn)(),ge.getOne).put(ge.updateOne).delete(ge.deleteOne),he.route("/resend").get(ge.requestResend).post(ge.validateEmail,ge.validateHuman("confirmEmail"),ge.resend,ge.sendConfirmEmail),he.get("/confirm/:token",ge.confirmEmail),he.route("/forgot").get(ge.forgotPasswordForm).post(ge.validateEmail,ge.validateHuman("forgotPassword"),ge.forgotPassword,ge.sendResetEmail),he.route("/reset/:token").get(ge.validResetToken,ge.resetPasswordForm).post(ge.validResetToken,ge.validatePassword,ge.resetPassword,ge.sendPasswordUpdatedEmail);const ye=d.a.model("User");var ve={loginForm:(e,r)=>r.render("login"),loginUser:U.a.authenticate("local",{successReturnToOrRedirect:"/",failureRedirect:"/login",failureFlash:!0,successFlash:"You have logged in"}),logoutUser:(e,r)=>{e.logout(),e.flash("info","You have logged out"),r.redirect("/")},genOauthLogin:(e,r={})=>({auth:(t,s,a)=>(t.user?U.a.authorize:U.a.authenticate).call(U.a,e,r.scope&&{scope:r.scope})(t,s,a),authCb(r,t,s){const a=r.user?U.a.authorize:U.a.authenticate,o=r.user?{failureRedirect:"/profile",failureFlash:`${e} account was not linked`}:(a,o,n)=>a?s(a):o?r.login(o,a=>a?s(a):(r.flash("success",`You have logged in, ${o[e].displayName||o[e].username}`),n.firstLogin?t.redirect("/profile"):t.redirect("/"))):(r.flash("error",`Permission to login via ${e} was denied`),t.redirect("/login"));return a.call(U.a,e,o)(r,t,s)}}),profile:(e,r)=>{const{user:t}=e,s=Object.entries(t.toObject()).reduce((e,[r,t])=>(("local"===r&&t.email||t.token)&&(e[r]=t.email||t.displayName),e),{}),a=["local","twitter","google","facebook"].filter(e=>!s[e]);r.render("profile",{body:{username:e.user.username,email:e.user.local.email},linkedAccounts:s,linkable:a})},authLocal:U.a.authorize("local",{failureRedirect:"/link/local",failureFlash:"Email or password is invalid"}),linkAccount:async(e,r,t)=>{const{user:s,account:a}=e;if(s&&a){const t=a.toObject({transform(e,r){const t=Object.assign({},r);return delete t.__v,delete t._id,t}});return t.local&&await ye.deleteOne({"local.email":t.local.email}),Object.assign(s,t,{username:s.username}),await s.save(),await a.remove(),e.flash("success","Accounts have been linked"),r.redirect("/profile")}return t()},unlinkAccount:async(e,r,t)=>{const s=e.params.account,{user:a}=e;if(!["twitter","google","facebook","local"].includes(s)){const e=new Error("Unknown account type");return e.status=400,t(e)}if(1===a.accountsTotal)return e.flash("error","Unable to unlink solo account"),r.redirect("/profile");if("local"===s){const e=Object.assign({},a.local);a.local=void 0,await a.save(),await ye.create({local:e,username:await ye.genUniqueUsername()})}else a[s].token=void 0,await a.save();return e.flash("success","Account has been unlinked"),r.redirect("/profile")},linkLocalForm:(e,r)=>r.render("link_local"),validateProfile:ce(ie("username","email"),"profile"),updateProfile:async(e,r)=>{const{username:t,email:s,password:a}=e.body;t!==e.user.username&&(e.user.username=t),e.user.local&&s!==e.user.local.email&&(e.user.local.email=s),a&&(e.user.local.password=await ye.hashPassword(a)),await e.user.save(),e.flash("success","Account updated"),r.redirect("/profile")},preValidateProfile:(e,r,t)=>e.body.password?t("route"):t(),validateProfilePassword:ce(ie("username","email","password","password-confirm"),"profile")};const be=(e,r,t)=>{e.isAuthenticated()?t():r.redirect("/")},ke=a.a.Router();ke.get("/login",ve.loginForm),ke.post("/login",ve.loginUser),ke.get("/logout",be,ve.logoutUser),ke.get("/profile",be,ve.profile),ke.post("/profile",be,ve.preValidateProfile,ve.validateProfile,le(ve.updateProfile)),ke.post("/profile",ve.validateProfilePassword,le(ve.updateProfile)),ke.get("/link/local",be,ve.linkLocalForm),ke.post("/link/local",be,ve.authLocal,le(ve.linkAccount)),ke.post("/unlink/:account",be,le(ve.unlinkAccount)),[{provider:"facebook",config:{scope:"email"}},{provider:"twitter"},{provider:"google",config:{scope:"https://www.googleapis.com/auth/userinfo.profile"}}].forEach(({provider:e,config:r})=>{const{auth:t,authCb:s}=ve.genOauthLogin(e,r);ke.get(`/auth/${e}`,t),ke.get(`/auth/${e}/callback`,s,le(ve.linkAccount)),ke.get(`/link/${e}`,be,t)});const Ee=a.a.Router();Ee.use("/",ke),Ee.use("/",he),Ee.get("/",(e,r)=>{r.render("index",{title:"Join"})}),Ee.post("/chat",(e,r)=>{r.render("chat",{title:"Chat"})}),Ee.use((e,r,t,s)=>{if(!e.errors)return s(e);const a=Object.keys(e.errors);return a.length>0&&a.forEach(t=>r.flash("error",e.errors[t].message)),t.redirect("back")}),Ee.use((e,r,t,s)=>{const a=e.status||500;t.status(a).render("error",{status:a,message:e.message})});var Oe=Ee;const Re=a()(),Pe=n.a.createServer(Re),Se=c()(Pe);S().catch(e=>console.error("Could not connect to DB",e.message)),Re.set("view engine","pug"),Re.set("trust proxy",!0),Re.use(re.a),Se.use((e,r)=>{Object(re.b)(e.handshake,{},r)}),Se.on("connection",e=>{console.log("New user connected"),ee(e,Se)}),Re.use((e,r,t)=>{e.login=Object(l.promisify)(e.login.bind(e)),t()}),Re.use((e,r,t)=>{const s=e.flash();r.locals.user=e.user,r.locals.flashes=Object.keys(s).length>0?s:void 0,t()}),Re.use("/",Oe);const Te=process.env.PORT||4e3;Pe.listen(Te,()=>{console.log(`Server started on port ${Te}`)})},function(e,r){e.exports=require("connect-mongo")},function(e,r,t){e.exports=t(26)}]);
//# sourceMappingURL=server.bundle.js.map